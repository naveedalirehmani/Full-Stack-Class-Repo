{"version":3,"names":["requireNoInterop","source","template","expression","ast","requireInterop","file","t","callExpression","addHelper","transformDynamicImport","path","noInterop","buildRequire","getDynamicImportSource","node","replacement","isStringLiteral","isTemplateLiteral","quasis","length","identifier","replaceWith"],"sources":["../src/dynamic-import.ts"],"sourcesContent":["// Heavily inspired by\n// https://github.com/airbnb/babel-plugin-dynamic-import-node/blob/master/src/utils.js\n\nimport type { NodePath } from \"@babel/traverse\";\nimport { types as t, template, type File } from \"@babel/core\";\nimport { getDynamicImportSource } from \"@babel/helper-module-transforms\";\n\nconst requireNoInterop = (source: t.Expression) =>\n  template.expression.ast`require(${source})`;\n\nconst requireInterop = (source: t.Expression, file: File) =>\n  t.callExpression(file.addHelper(\"interopRequireWildcard\"), [\n    requireNoInterop(source),\n  ]);\n\nexport function transformDynamicImport(\n  path: NodePath<t.CallExpression>,\n  noInterop: boolean,\n  file: File,\n) {\n  const buildRequire = noInterop ? requireNoInterop : requireInterop;\n\n  const source = getDynamicImportSource(path.node);\n\n  const replacement =\n    t.isStringLiteral(source) ||\n    (t.isTemplateLiteral(source) && source.quasis.length === 0)\n      ? template.expression.ast`\n        Promise.resolve().then(() => ${buildRequire(source, file)})\n      `\n      : template.expression.ast`\n        Promise.resolve(${source}).then(\n          s => ${buildRequire(t.identifier(\"s\"), file)}\n        )\n      `;\n\n  path.replaceWith(replacement);\n}\n"],"mappings":";;;;;;AAIA;AACA;;AAEA,MAAMA,gBAAgB,GAAIC,MAAoB,IAC5CC,cAAQ,CAACC,UAAU,CAACC,GAAI,WAAUH,MAAO,GAAE;AAE7C,MAAMI,cAAc,GAAG,CAACJ,MAAoB,EAAEK,IAAU,KACtDC,WAAC,CAACC,cAAc,CAACF,IAAI,CAACG,SAAS,CAAC,wBAAwB,CAAC,EAAE,CACzDT,gBAAgB,CAACC,MAAM,CAAC,CACzB,CAAC;AAEG,SAASS,sBAAsB,CACpCC,IAAgC,EAChCC,SAAkB,EAClBN,IAAU,EACV;EACA,MAAMO,YAAY,GAAGD,SAAS,GAAGZ,gBAAgB,GAAGK,cAAc;EAElE,MAAMJ,MAAM,GAAG,IAAAa,8CAAsB,EAACH,IAAI,CAACI,IAAI,CAAC;EAEhD,MAAMC,WAAW,GACfT,WAAC,CAACU,eAAe,CAAChB,MAAM,CAAC,IACxBM,WAAC,CAACW,iBAAiB,CAACjB,MAAM,CAAC,IAAIA,MAAM,CAACkB,MAAM,CAACC,MAAM,KAAK,CAAE,GACvDlB,cAAQ,CAACC,UAAU,CAACC,GAAI;AAChC,uCAAuCS,YAAY,CAACZ,MAAM,EAAEK,IAAI,CAAE;AAClE,OAAO,GACCJ,cAAQ,CAACC,UAAU,CAACC,GAAI;AAChC,0BAA0BH,MAAO;AACjC,iBAAiBY,YAAY,CAACN,WAAC,CAACc,UAAU,CAAC,GAAG,CAAC,EAAEf,IAAI,CAAE;AACvD;AACA,OAAO;EAELK,IAAI,CAACW,WAAW,CAACN,WAAW,CAAC;AAC/B"}